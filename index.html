<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ””</text></svg>">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Toast Notifications</title>
    <style>
      body {
        margin: unset;
        min-height: 100dvh;
        place-content: center;
        text-align: center;
      }

      menu {
        padding: unset;
        overflow: auto;
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 1rem;
      }

      button {
        touch-action: manipulation;
        user-select: none;
        -webkit-user-select: none;
      }

      [data-toast="popover"] {
        --toast-width: 380px;
        padding: 1.5rem;
      }

      [data-toast="popover"]:popover-open {
        gap: 1rem;
      }

      [data-toast="notification"] {
        display: flex;
        justify-content: space-between;
        padding: 1rem;
        background-color: white;
        border: 1px solid #0000001a;
        border-radius: 1rem;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.102);
        position: relative;
      }

      [data-toast="content"] {
        display: flex;
        flex-direction: column;
        align-items: flex-start;
        flex: 1;
        gap: .5rem;
      }
      [data-toast="content"] h1,
      [data-toast="content"] p {
        margin: unset;
      }

      [data-toast="menubar"] {
        view-transition-name: toast-menubar;
        view-transition-class: toast-menubar;
      }

      ::view-transition-old(.toast-actions):only-child {
        --slideX: 0;
        --slideY: calc(-100%);
        animation-name: slide-out;
      }
      ::view-transition-new(.toast-actions):only-child {
        --slideX: 0;
        --slideY: calc(-100%);
        animation-name: slide-in;
      }

      [data-toast="popover"]:not([data-minimized]) [data-toast="menubar"] {
        display: flex;
        justify-content: flex-end;
        gap: .5rem;
      }

      [data-minimized] [data-toast="root"]:not(:first-child) [data-toast="notification"] [data-toast-button="clear"] {
        display: none;
      }


      [data-toast="notification"] [data-toast-button="clear"] {
        position: absolute;
        right: 100%;
        bottom: 100%;
        translate: 50% 50%;
        aspect-ratio: 1;
        border-radius: 100%;
        z-index: inherit;

        background-color: buttonface;
        border: 1px outset buttonborder;

        opacity: 0;
        transition: opacity .3s ease-in-out;
      }

      [data-toast="notification"]:hover [data-toast-button="clear"] {
        opacity: 1;
      }


    </style>
  </head>
  <body>
    <section>
        <span>Toast Position</span>
        <menu>
          <button onClick="setToastPosition('top start')">top start</button>
          <button onClick="setToastPosition('top center')">top center</button>
          <button onClick="setToastPosition('top end')">top end</button>
          <button onClick="setToastPosition('bottom start')">bottom start</button>
          <button onClick="setToastPosition('bottom center')">bottom center</button>
          <button onClick="setToastPosition('bottom end')">bottom end</button>
        </menu>
    </section>

    <button data-action="add-toast">ðŸ””</button>
    <script type="module">
      import {ToastQueue} from './src/index.js';

      const toastPosition = localStorage.getItem('toast-position') || 'top center';

      window.toast = new ToastQueue({
        // timeout: 6000,
        position: toastPosition,
        root: document.body
      });

      window.setToastPosition = (value) => {
        window.toast.position = value;
        localStorage.setItem('toast-position', value);
      }

      document.addEventListener('click', event => {
        if (event.target.dataset.action === 'add-toast') {
          window.toast.add(`<h1>Title</h1><p>${Date.now()}</p>`, { action: { label: 'action 1', fn: () => console.log(Date.now()) } })
          return;
        }

        if (event.target.dataset.toastButton === 'clear') {
          const toastId = event.target.closest('[data-toast-id]').dataset.toastId;
          toast.delete(toastId);
          return;
        }

        if (event.target.dataset.toastButton === 'action') {
          const toastId = event.target.closest('[data-toast-id]').dataset.toastId;
          const toast = window.toast.get(toastId);
          toast?.action?.fn();
          return;
        }

          // Easy close
        if (!event.target.closest('[data-toast="popover"]')) {
          if (!toast.isMinimized) {
            toast.isMinimized = true;
          }
          return
        }

        // Maximize
        if (event.target.closest('[data-minimized]')) {
          if (event.target.closest('[data-swiping]')) return;
          toast.isMinimized = false;
          return;
        }

        // Minimize
        if (event.target.dataset.toastButton === 'minimize') {
          toast.isMinimized = true;
          return;
        }

        // Clear
        if (event.target.dataset.toastButton === 'clear-all') {
          toast.clearAll();
          return;
        }
      })
    </script>
  </body>
</html>
